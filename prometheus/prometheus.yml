# Prometheus Configuration for AkiDB
# Scrapes metrics from AkiDB REST API /metrics endpoint
# Compatible with Docker Compose deployment

global:
  scrape_interval: 15s      # Scrape metrics every 15 seconds
  evaluation_interval: 15s  # Evaluate rules every 15 seconds
  scrape_timeout: 10s       # Timeout after 10 seconds

  # External labels for Alertmanager/federation
  external_labels:
    cluster: 'akidb-local'
    environment: 'development'

# Alertmanager configuration (optional - Day 5)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

# Load alert rules from alerts.yml (Day 5)
rule_files:
  - 'alerts.yml'

# Scrape configurations
scrape_configs:
  # AkiDB REST API metrics
  - job_name: 'akidb-rest'

    # Scrape from REST API /metrics endpoint
    static_configs:
      - targets: ['akidb-rest:8080']
        labels:
          service: 'akidb'
          component: 'rest-api'

    # Scrape interval override (optional)
    scrape_interval: 10s

    # Metrics path
    metrics_path: '/metrics'

    # Relabel configs (optional - for advanced filtering)
    metric_relabel_configs:
      # Drop metrics with empty values (optional)
      - source_labels: [__name__]
        regex: 'akidb_.*'
        action: keep

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # Optional: Grafana metrics (if enabled)
  # - job_name: 'grafana'
  #   static_configs:
  #     - targets: ['grafana:3000']
  #       labels:
  #         service: 'grafana'

# Storage configuration
storage:
  tsdb:
    path: /prometheus/data
    retention:
      time: 7d        # Keep metrics for 7 days
      size: 1GB       # Maximum storage size

# Remote write (optional - for long-term storage)
# remote_write:
#   - url: 'http://remote-storage:9201/write'
#     queue_config:
#       capacity: 10000
#       max_shards: 5

# Remote read (optional)
# remote_read:
#   - url: 'http://remote-storage:9201/read'
